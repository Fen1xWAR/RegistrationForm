<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="Style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <title>Form</title>
</head>
<body>
<button class="MainButtonViolet"  onclick="ShowModal('formreg')">Жмав для регистрации</button>
<button class="MainButtonViolet"  onclick="ShowModal('formsing')">Жмав для входа</button>
<div class="ModalContainer" id="formreg">
    <form action="Index.html" class="form" id="form1">

        <div class="FormElement">
            <div class="CloseIcon" onclick="CloseModal('formreg')">❌</div>
            <div class="header">Регистрация</div>
            <br>
            <label for="login">Введите логин: </label>
            <input type="text" class="textField" name="login" id="loginReg" placeholder="Логин" value="" required><br>
            <label for="Mail">Введите ваш Email: </label>
            <input type="text" class="textField" name="Mail" id="mailReg" placeholder="Email" value="" required><br>
            <label for="Pass">Укажите пароль: </label>
            <input type="password" class="textField" name="Pass" id="passReg" placeholder="Пароль" value="" required><br>
            <label for="Sex">Ваш пол: </label>
            <input type="radio" class="radio" id="Sex0" name="Sex" required>М
            <input type="radio" class="radio" id="Sex1" name="Sex" required>Ж
            <br>
            <div id="form-button">
                <input type="submit" class="MainButtonViolet f-button" value="Зарегистрироваться" id="cbutton">
            </div>
        </div>
    </form>
</div>
<div class="ModalContainer" id="formsing">
    <form action="Index.html" class="form" id="forms1">

        <div class="FormElement">
            <div class="CloseIcon" onclick="CloseModal('formsing')">❌</div>
            <div class="header">Вход</div>
            <br>
            <label for="login">Ваш логин: </label>
            <input type="text" class="textField" name="loginSing" placeholder="Логин" value="" id="loginSing" required><br>
            <label for="Mail">Ваш Email: </label>
            <input type="text" class="textField" name="MailSing" placeholder="Email" value="" id="mailSing" required><br>
            <div class="InputContainer" id="Password">
                <label for="Pass">Ваш пароль: </label>
                <div class="PasswordInput">
                    <input type="password" id="passSing" name="password" class="textField Toggleable"  placeholder="Пароль"
                           value="" required>
                    <i onclick="Toogle()" id="eye-slash" class="bi bi-eye-slash eye"></i>
                </div>
            </div>
            <br>
            <div id="form-button">
                <input type="submit" class="MainButtonViolet f-button" value="Войти" id="cbutton1">
            </div>
        </div>
    </form>
</div>
</body>
<script>




    document.getElementById('formreg').onsubmit = function (e) {
        e.preventDefault();
        e.stopPropagation();

        let login = document.getElementById("loginReg").value
        let mail = document.getElementById("mailReg").value
        let pass = document.getElementById("passReg").value
        let sex = document.getElementById("Sex0").checked
    if (validateEmail(mail)){
        if ( SaveJSONReg(login,pass,mail,sex)) {
            AddNotification("Успешная регистрация!");
            setTimeout(CloseModal,1000,'formreg')
        }
        else{
            AddNotification('Такой пользователь уже существует!')
        }
    }
    else{
        AddNotification('Неверный формат почты!')
    }

    }
    document.getElementById('formsing').onsubmit = function (e) {
        e.preventDefault();
        e.stopPropagation();
        let login = document.getElementById("loginSing").value
        let mail = document.getElementById("mailSing").value
        let pass = document.getElementById("passSing").value
        if (JSONRegDataCheckout(login,mail,pass)){
            (AddNotification("Успешный вход!"), setInterval(location.href = 'http://www.yandex.ru/', 1000))
        }
        else{

        }

     }
    function validateEmail(email) {
            var re = /[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/;
        return re.test(String(email).toLowerCase());
    }
    function Toogle() {
        let typeOfPassword = $("input[name='password']")
        let eyeIco = $('.eye')
        let value = typeOfPassword.attr('type')
        if (value == 'password'){
            typeOfPassword.attr('type','text')
            eyeIco.toggleClass('bi-eye-slash bi-eye')
        }
        else{
            typeOfPassword.attr('type','password')
            eyeIco.toggleClass  ('bi-eye bi-eye-slash')
        }

    }

    function  JSONRegDataCheckout(login,mail,password){
            if (localStorage.getItem('users') == undefined){
                saveJSON(jsonFileContent)
            }
            let JsonFile = localStorage.getItem('users')
            let JsonData = JSON.parse(JsonFile)
            let key = login
            if (JsonData.Users[key] == undefined){
                AddNotification('Данного пользователя не существует!')
                return false
            }
            else{
                RemoveNotification()
                let currentUser   =  JsonData.Users[key]
                if(currentUser.login == login && currentUser.password == password && currentUser.mail == mail){
                return true
                    }
                else{
                    AddNotification("Логин или пароль неверны!")
                    return false
                }
            }
    }
    var jsonFileContent = '{"Users":{}}';
    function saveJSON(jsonfile){
        localStorage.setItem('users',jsonfile);
    }
    function SaveJSONReg(login,password,mail,sex){
        if (localStorage.getItem('users') == undefined){
            saveJSON(jsonFileContent)
        }
        let JsonFile = localStorage.getItem('users')
        let JsonData = JSON.parse(JsonFile)
        let key = login

        if (JsonData.Users[key] == undefined){
            JsonData.Users[key] = {'login':login,'password':password,'mail':mail,'male':sex}
            RemoveNotification()
            JsonFile = JSON.stringify(JsonData)
            saveJSON(JsonFile)
            return true
            }
        else{
            return false

        }

    }

    function AddToggleablePass() {
        let eye = document.createElement(`i`)
        eye.classList.add('bi')
        eye.classList.add('bi-eye-slash')
        eye.classList.add('eye')
        let pass = document.getElementsByClassName('Toggleable')[0]
        pass.parentNode.appendChild(eye)
    }


    function ShowModal(ModalID) {
        let modal = document.getElementById(ModalID);
        modal.classList.add("modalShown")

    }

    function CloseModal(ModalID) {
        let modal = document.getElementById(ModalID);
        modal.classList.remove("modalShown");
        setTimeout(RemoveNotification(),1000)
    }

    function RemoveNotification() {
        if ((document.getElementsByClassName('AlertPosition')[0])) {
            document.getElementsByClassName('AlertPosition')[0].removeChild(document.getElementsByClassName('AlertBox')[0])
            document.getElementsByTagName("body")[0].removeChild(document.getElementsByClassName('AlertPosition')[0])
        }
    }

    function AddNotification(NotificationText) {
        if (!(document.getElementsByClassName("AlertPosition").length == 0)) {
            RemoveNotification()
        }
        let Notification = document.createElement("div");
        let NotificationContainer = document.createElement("div");
        NotificationContainer.classList.add("AlertPosition");
        Notification.classList.add("AlertBox");
        Notification.textContent = NotificationText;
        document.getElementsByTagName("body")[0].appendChild(NotificationContainer);
        document.getElementsByClassName("AlertPosition")[0].appendChild(Notification);
    }

</script>
</html>